FROM ubuntu:22.04

RUN apt update && apt install -y curl mariadb-client && \
    apt-get autoremove -y && \
    apt-get clean all && \
    rm -rf /var/lib/apt/lists/*

RUN mkdir -p /var/lib/nautobot

ARG DOLT_RELEASE="v0.54.2"
RUN curl -L https://github.com/dolthub/dolt/releases/download/${DOLT_RELEASE}/install.sh | bash

RUN dolt config --global --add user.name nautobot
RUN dolt config --global --add user.email opensource@networktocode.COM
RUN dolt config --global --add init.defaultbranch main

WORKDIR /var/lib/nautobot

COPY ./development/dolt-config.yaml /dolt-config.yaml

EXPOSE 3306

ENV DOLT_ENABLE_DB_REVISIONS=true

RUN dolt init

ARG DOLT_TRACE=""
CMD dolt sql-server --config /dolt-config.yaml ${DOLT_TRACE}
